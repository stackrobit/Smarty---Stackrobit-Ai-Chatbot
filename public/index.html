<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stackrobit ‚Äî AI Chatbot</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="icon" href="stackrobit.png" type="image/png">
<style>
  :root{
    --bg-1: #070a14;   /* deep */
    --panel: rgba(15,20,40,0.6);
    --glass-border: rgba(255,255,255,0.06);
    --neon-a: #9b66ff;
    --neon-b: #0066ff;
    --neon-c: #ff5fb4;
    --accent: linear-gradient(135deg,var(--neon-a),var(--neon-b),#00eaff);
  }
  html,body{height:100%;margin:0;background:var(--bg-1);font-family:Inter,system-ui,Arial,sans-serif;color:#e6eefc}
  /* optional background orbs (to match screenshot) */
  .bg-orbs{
    position:fixed; inset:0; pointer-events:none; z-index:0; mix-blend-mode:screen;
    background:
      radial-gradient( circle at 10% 20%, rgba(155,102,255,0.16) 0 160px, transparent 300px),
      radial-gradient( circle at 85% 15%, rgba(0,160,255,0.12) 0 200px, transparent 380px),
      radial-gradient( circle at 70% 75%, rgba(255,95,180,0.09) 0 220px, transparent 450px);
    filter: blur(20px);
  }

  /* Floating toggle */
  .chat-toggle {
    position: fixed;
    right: 28px;
    bottom: 28px;
    width: 78px;
    height: 78px;
    border-radius: 999px;
    background: radial-gradient(circle at 20% 25%, rgba(255,255,255,0.06), transparent 40%), var(--accent);
    display:flex; align-items:center; justify-content:center;
    color:white; font-size:34px; cursor:pointer; z-index:999;
    box-shadow: 0 8px 30px rgba(80,0,200,0.45), 0 4px 18px rgba(0,100,255,0.18);
    transition: transform .18s ease, box-shadow .18s;
  }
  .chat-toggle:hover{ transform: scale(1.07); box-shadow: 0 12px 40px rgba(80,0,200,0.6) }

  /* Widget */
  .chat-widget {
    position: fixed;
    right: 40px;
    bottom: 120px;
    width: 420px;
    height: 540px;
    border-radius: 20px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border: 1px solid var(--glass-border);
    backdrop-filter: blur(12px) saturate(1.1);
    box-shadow: 0 10px 40px rgba(0,0,0,0.6), 0 0 30px rgba(80,0,200,0.12);
    display: none;
    z-index: 998;
    overflow: hidden;
    flex-direction: column;
  }

  /* animated neon border */
  .chat-widget::before{
    content: "";
    position: absolute; inset: -2px;
    border-radius: 22px;
    background: conic-gradient(from 120deg, rgba(155,102,255,0.6), rgba(0,102,255,0.6), rgba(255,95,180,0.6), rgba(155,102,255,0.6));
    filter: blur(18px) saturate(1.2);
    opacity: 0.5;
    z-index: -1;
    animation: rotateGrad 8s linear infinite;
  }
  @keyframes rotateGrad { to{ transform: rotate(360deg) } }

  .chat-header{
    padding: 16px 18px;
    display:flex; align-items:center; gap:12px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
  }
  .bot-icon{
    width:46px; height:46px; border-radius:12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    display:flex; align-items:center; justify-content:center; font-weight:700;
    box-shadow: inset 0 -6px 18px rgba(0,0,0,0.25);
  }
  .title{
    flex:1;
    font-weight:700; color:#eaf0ff; font-size:16px;
    line-height:1;
  }
  .subtitle{ font-size:12px; color:rgba(230,238,252,0.7) }

  .chat-body{
    flex:1; padding:16px; overflow:auto;
    background: linear-gradient(180deg, rgba(8,12,25,0.02), transparent);
  }

  .msg{
    display:inline-block; padding:12px 14px; border-radius:14px; margin-bottom:10px; line-height:1.4;
    max-width:78%;
  }
  .msg.bot{
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.03);
    color:#e6efff;
    box-shadow: 0 6px 18px rgba(10,12,20,0.3);
  }
  .msg.user{
    margin-left:auto;
    background: linear-gradient(135deg,var(--neon-a),var(--neon-b));
    color:white;
    box-shadow: 0 10px 30px rgba(0,100,255,0.18);
  }

  .typing{
    display:inline-block; padding:8px 12px; border-radius:12px; background:rgba(255,255,255,0.03); color:rgba(255,255,255,0.7);
  }

  .chat-footer{
    padding: 12px; display:flex; gap:10px; align-items:center; border-top:1px solid rgba(255,255,255,0.03);
  }

  .input{
    flex:1; display:flex; gap:8px; align-items:center;
    background: rgba(255,255,255,0.02); padding:8px; border-radius:12px;
  }
  .input input{
    background:transparent; border:none; outline:none; color:#e6eefc; font-size:14px; padding:8px;
    width:100%;
  }

  .send-btn{
    min-width:78px; padding:10px 12px; border-radius:12px; cursor:pointer;
    background: linear-gradient(135deg,var(--neon-a),var(--neon-b));
    color:white; font-weight:600; border:none;
    box-shadow: 0 10px 30px rgba(90,0,255,0.18);
  }

  /* small responsive */
  @media (max-width:520px){
    .chat-widget{ right:16px; left:16px; width:auto; bottom:100px; }
    .chat-toggle{ right:16px; bottom:18px; }
  }
</style>
</head>
<body>

<div class="bg-orbs"></div>

<!-- Toggle -->
<div class="chat-toggle" id="toggleBtn" title="Open chat">üí¨</div>

<!-- Widget -->
<div class="chat-widget" id="chatWidget" role="dialog" aria-label="Support chat">
  <div class="chat-header">
    <div class="bot-icon">SB</div>
    <div>
      <div class="title">Smarty - Ai Chatbot</div>
      <div class="subtitle">Instant answers ‚Ä¢Stackrobit's AI Chatbot</div>
    </div>
    <div style="width:10px"></div>
  </div>

  <div class="chat-body" id="chatBody" aria-live="polite">
    <!-- messages added here -->
    <div class="msg bot">Hi ‚Äî I'm your support assistant. How can I help you today?</div>
  </div>

  <div class="chat-footer">
    <div class="input" role="group" aria-label="Chat input">
      <input id="userInput" type="text" placeholder="Ask about billing, posting projects, refunds..." aria-label="Type your message" />
    </div>
    <button class="send-btn" id="sendBtn" aria-label="Send message">Send</button>
  </div>
</div>

<script>
/* --------------- EDIT THIS to your deployed backend --------------- */
let API_URL = "http://localhost:3000/api/chat"; // <-- replace with Railway URL after deploy
/* ----------------------------------------------------------------- */

const toggleBtn = document.getElementById('toggleBtn');
const widget = document.getElementById('chatWidget');
const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const chatBody = document.getElementById('chatBody');

toggleBtn.addEventListener('click', ()=> {
  widget.style.display = widget.style.display === 'flex' ? 'none' : 'flex';
  widget.style.flexDirection = 'column';
  userInput.focus();
});

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keydown', (e)=> { if(e.key === 'Enter') sendMessage(); });

function addMessage(text, cls='bot'){
  const d = document.createElement('div');
  d.className = `msg ${cls}`;
  d.textContent = text;
  chatBody.appendChild(d);
  chatBody.scrollTop = chatBody.scrollHeight;
  return d;
}

function setTyping(on=true){
  if(on){
    const el = document.createElement('div'); el.className='typing'; el.id='typingIndicator';
    el.textContent = 'Assistant is typing...';
    chatBody.appendChild(el);
    chatBody.scrollTop = chatBody.scrollHeight;
  } else {
    const t = document.getElementById('typingIndicator'); if(t) t.remove();
  }
}

async function sendMessage(){
  const text = userInput.value.trim();
  if(!text) return;
  addMessage(text, 'user');
  userInput.value = '';
  setTyping(true);

  try{
    const res = await fetch(API_URL, {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ message: text })
    });
    if(!res.ok){
      const txt = await res.text();
      setTyping(false);
      addMessage('Sorry ‚Äî server error: '+txt, 'bot');
      return;
    }
    const data = await res.json();
    setTyping(false);
    if(data.reply) addMessage(data.reply, 'bot');
    else addMessage('No reply from server', 'bot');

    if(data.escalate){
      addMessage('‚ö†Ô∏è This has been escalated to support. They will contact you soon.', 'bot');
    }
  }catch(err){
    setTyping(false);
    addMessage('Network error ‚Äî please try again later.', 'bot');
    console.error(err);
  }
}
</script>
</body>
</html>
